<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1">-->
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <title>bootstrap</title>
    <link rel="stylesheet" type="text/css" href="stylesheets/style.css">
    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css">
    <!--[if IE]>
        <script src="js/html5.js"></script>
    <![endif]-->
    <!--[if it IE 9]>
        <script src="js/css3-mediaqueries.js"></script>
    <![endif]-->
</head>

<body>
    <div class="container-fluid hid hide">
        <!-- 头部 -->
        <div class="row head-bg">
            <div class="col-md-12"><img src="images/logo.png">小蚂蚁移动教学平台</div>
        </div>
        <!-- 左边导航 -->
        <div class="row">
            <div class="col-md-2 nav">
                <ul class="nav-outer">
                    <li>
                        <a><img src="images/icon1.png">
                            <br/>教学进度</a>
                    </li>
                    <li>
                        <a><img src="images/icon2.png">
                            <br/>题库中心</a>
                    </li>
                    <li>
                        <a><img src="images/icon3.png">
                            <br/>备课</a>
                    </li>
                    <li>
                        <a class="hover"><img src="images/icon4.png">
                            <br/>统计＋回顾</a>
                        <!-- 子导航 -->
                        <ul class="nav-in">
                            <li><a>课堂讲义回顾</a></li>
                            <li><a class="hover-in">课堂练习回顾</a></li>
                            <li><a>家庭作业回顾</a></li>
                        </ul>
                    </li>
                    <li>
                        <a><img src="images/icon5.png">
                            <br/>资源中心</a>
                    </li>s
                </ul>
            </div>
            <!-- 右边内容 -->
            <div class="col-md-10">
                <!-- 内容顶部信息 -->
                <div class="row content-top">
                    <!-- 内容顶部左边 -->
                    <div class="col-md-9 content-l"><img src="images/position.png">教学进度&nbsp;&gt;&nbsp;教学进度管理</div>
                    <!-- 内容顶部右边 -->
                    <div class="col-md-3 content-r">
                        <form class="form-inline">
                            <div class="form-group">
                                <div class="input-group content-r">
                                    <input type="text" class="form-control" id="exampleInputAmount" placeholder="">
                                    <div class="input-group-addon"><img src="images/seo.png"></div>
                                </div>
                            </div>
                    </div>
                </div>
                <!-- 内容中间 -->
                <div class="row">
                    <!-- 内容中间左边，表格标题 -->
                    <div class="col-md-9 content-c">教学进度</div>
                    <!-- 内容中间右边，按钮 -->
                    <div class="col-md-3 but">
                        <button type="button" class="btn btn-warning"><img src="images/insert.png">添加教学进度</button>
                        <button type="button" class="btn btn-default"><img src="images/delete.png">删除</button>
                    </div>
                </div>
                <!-- 内容下面 -->
                <div class="row">
                    <div class="col-md-12  foot">
                        <table class="table table-bordered table-hover table-striped">
                            <thead>
                                <tr>
                                    <th>
                                        <label>
                                            <input type="checkbox">
                                        </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;标题</th>
                                    <th>描述</th>
                                    <th>添加时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <label>
                                            <input type="checkbox">
                                        </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;三年级数学第一章第一单元第二课时</td>
                                    <td>三角形的面积</td>
                                    <td>2015-12-03</td>
                                    <td><img src="images/selection.png"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>
                                            <input type="checkbox">
                                        </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;三年级数学第一章第一单元第二课时</td>
                                    <td>三角形的面积</td>
                                    <td>2015-12-03</td>
                                    <td><img src="images/selection.png"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>
                                            <input type="checkbox">
                                        </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;三年级数学第一章第一单元第二课时</td>
                                    <td>三角形的面积</td>
                                    <td>2015-12-03</td>
                                    <td><img src="images/selection.png"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>
                                            <input type="checkbox">
                                        </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;三年级数学第一章第一单元第二课时</td>
                                    <td>三角形的面积</td>
                                    <td>2015-12-03</td>
                                    <td><img src="images/selection.png"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>
                                            <input type="checkbox">
                                        </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;三年级数学第一章第一单元第二课时</td>
                                    <td>三角形的面积</td>
                                    <td>2015-12-03</td>
                                    <td><img src="images/selection.png"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>
                                            <input type="checkbox">
                                        </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;三年级数学第一章第一单元第二课时</td>
                                    <td>三角形的面积</td>
                                    <td>2015-12-03</td>
                                    <td><img src="images/selection.png"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>
                                            <input type="checkbox">
                                        </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;三年级数学第一章第一单元第二课时</td>
                                    <td>三角形的面积</td>
                                    <td>2015-12-03</td>
                                    <td><img src="images/selection.png"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>
                                            <input type="checkbox">
                                        </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;三年级数学第一章第一单元第二课时</td>
                                    <td>三角形的面积</td>
                                    <td>2015-12-03</td>
                                    <td><img src="images/selection.png"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>
                                            <input type="checkbox">
                                        </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;三年级数学第一章第一单元第二课时</td>
                                    <td>三角形的面积</td>
                                    <td>2015-12-03</td>
                                    <td><img src="images/selection.png"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>
                                            <input type="checkbox">
                                        </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;三年级数学第一章第一单元第二课时</td>
                                    <td>三角形的面积</td>
                                    <td>2015-12-03</td>
                                    <td><img src="images/selection.png"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>
                                            <input type="checkbox">
                                        </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;三年级数学第一章第一单元第二课时</td>
                                    <td>三角形的面积</td>
                                    <td>2015-12-03</td>
                                    <td><img src="images/selection.png"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>
                                            <input type="checkbox">
                                        </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;三年级数学第一章第一单元第二课时</td>
                                    <td>三角形的面积</td>
                                    <td>2015-12-03</td>
                                    <td><img src="images/selection.png"></td>
                                </tr>
                                <tr>
                                    <td>
                                        <label>
                                            <input type="checkbox">
                                        </label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;三年级数学第一章第一单元第二课时</td>
                                    <td>三角形的面积</td>
                                    <td>2015-12-03</td>
                                    <td><img src="images/selection.png"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="token">
        
    </div>
    <!-- 退出 -->
    <div class="quit">
        <input type="button" value="退出" id="quit" />
    </div>
    <!-- 表格 -->
    <div class="table-responsive">
        <table class="table table-bordered">
            <tr>
                <th>newsid</th>
                <th>newstitle</th>
                <th>newsimg</th>
                <th>newstext</th>
                <th>newsdate</th>
                <th>navdate</th>
                <th></th>
                <th></th>
            </tr>
            <!--             <tr>
                <td>1</td>
                <td>2</td>
                <td>3</td>
                <td>4</td>
                <td>5</td>
                <td class="update"><a>修改</a></td>
                <td><a>删除</a></td>
            </tr> -->
        </table>
    </div>
    <button type="button" class="btn btn-primary btn-lg btn-block" id="add">新增</button>
    <button type="button" class="btn btn-default btn-lg btn-block" id="lookUp">查找</button>
    <!-- 表单 -->
    <div class="slide">
        <form>
            <div class="form-group">
                <label for="exampleInputName2">新闻ID</label>
                <input type="text" class="form-control" placeholder="新闻ID" id="newsid" readonly="readonly" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">新闻标题</label>
                <input type="text" class="form-control" placeholder="新闻标题" id="newstitle" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">新闻图片</label>
                <input type="text" class="form-control" placeholder="新闻图片" id="newsimg" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">新闻内容</label>
                <input type="text" class="form-control" placeholder="新闻内容" id="newstext" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">新闻时间</label>
                <input type="text" class="form-control" placeholder="新闻时间" id="newsdate" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">选择导航</label>
                <input type="text" class="form-control" placeholder="选择导航" id="navdate" />
            </div>
            <button type="button" class="btn btn-primary btn-lg btn-block" id="submit1">提交</button>
            <button type="button" class="btn btn-default btn-lg btn-block resets">重置</button>
        </form>
    </div>
    <!-- 表单 -->
    <div class="slide1">
        <form>
            <div class="form-group">
                <label for="exampleInputName2">新闻ID</label>
                <input type="text" class="form-control" placeholder="新闻ID" id="newsid1" readonly="readonly" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">新闻标题</label>
                <input type="text" class="form-control" placeholder="新闻标题" id="newstitle1" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">新闻图片</label>
                <input type="text" class="form-control" placeholder="新闻图片" id="newsimg1" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">新闻内容</label>
                <input type="text" class="form-control" placeholder="新闻内容" id="newstext1" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">新闻时间</label>
                <input type="text" class="form-control" placeholder="新闻时间" id="newsdate1" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">选择导航</label>
                <input type="text" class="form-control" placeholder="选择导航" id="navdate1" />
            </div>
            <button type="button" class="btn btn-primary btn-lg btn-block" id="submit2">提交</button>
            <button type="button" class="btn btn-default btn-lg btn-block">重置</button>
        </form>
    </div>
    <!-- 表单 -->
    <div class="slide2">
        <p>提示：输入下面条件查询的任意一项，如果存在就能快速匹配到整个数据</p>
        <form>
            <div class="form-group">
                <label for="exampleInputName2">新闻ID</label>
                <input type="text" class="form-control" placeholder="新闻ID" id="newsid2" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">新闻标题</label>
                <input type="text" class="form-control" placeholder="新闻标题" id="newstitle2" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">新闻图片</label>
                <input type="text" class="form-control" placeholder="新闻图片" id="newsimg2" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">新闻内容</label>
                <input type="text" class="form-control" placeholder="新闻内容" id="newstext2" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">新闻时间</label>
                <input type="text" class="form-control" placeholder="新闻时间" id="newsdate2" />
            </div>
            <div class="form-group">
                <label for="exampleInputName2">选择导航</label>
                <input type="text" class="form-control" placeholder="选择导航" id="navdate2" />
            </div>
            <button type="button" class="btn btn-primary btn-lg btn-block" id="submit3">确认查找</button>
            <button type="button" class="btn btn-default btn-lg btn-block resets">重置</button>
        </form>
    </div>
    <div class="ssss"></div>
    <script type="text/javascript" src="js/jquery-2.1.4.js"></script>
    <script type="text/javascript">
    // 判断referrer
    // if (document.referrer=="http://localhost/baidu/bootstarp/index.html"&&document.referrer=="http://localhost/baidu/bootstarp/index1.html") {
    //      window.location.href="./index1.html";
    // }


    // 点击退出
    $("#quit").click(function(){
        alert("确定退出吗？退出的话下次就得重新登录");
        window.location.href="./index.html";
        $.ajax({
            url:"quit.php",
            type:"post",
            dataType:"json",
            success:function(){
            }

        });
    });
    // 点击新增
    $(document).ready(function() {
        $("#add,.slide").click(function(e) {
            $(".slide").slideDown(500);
            e.stopPropagation();
        });
        $(".slide1").click(function(e) {
            $(".slide1").slideDown(500);
            e.stopPropagation();
        });
        $("#lookUp,.slide2").click(function(e) {
            $(".slide2").slideDown(500);
            e.stopPropagation();
        });
        $(document).click(function() {
            $(".slide,.slide1,.slide2").slideUp(500);
            $(".slide,.slide1,.slide2").find("input").each(function(index) {
                $(".slide,.slide1,.slide2").find("input").eq(index).val("");
            });
        });
        // 点击修改

        // $("table").on('click','.update',function(e){
        //     $(".slide").slideDown(500);
        //     // 修改的时候将table的值赋予input中
        //     var data1={};
        //         $(".update").siblings().not($(".update").next()).each(function(index){
        //             data1[index]=$(".update").siblings().eq(index).text();
        //         });

        //         $(".slide").find("input").each(function(index){
        //         $(".slide").find("input").eq(index).val(data1[index]);
        //         });
        //     //阻止事件的传播 
        //     e.stopPropagation();
        //     // console.log($(".trs").length());
        // });


        // function clicks(){

        // }
        // $(".update").siblings().each() 
        // $(".update").siblings().each(function(index){

        // });
        // 点击删除


        // 点击重置
        $(".resets").click(function() {
            $("input").val("");
        });


// 获取登录时生成的token
var randomData;
// window.onload=function(){
                $.ajax({
                url:"token.php",
                type:"post",
                // async:false,  //调整为同步请求
                dataType:"json",
                data:{
                    // token:"1"
                },
                success:function(data){
                                randomData=data.token;

                                // 点击新增提交增加数据
                                $("#submit1").click(function(e) {
                                    // alert(randomData);
                                    $.ajax({
                                        url: "add.php",
                                        type: "post",
                                        dataType: "json",
                                        data: {
                                            newstitle: $("#newstitle").val(),
                                            newsimg: $("#newsimg").val(),
                                            newstext: $("#newstext").val(),
                                            newsdate: $("#newsdate").val(),
                                            navdate: $("#navdate").val(),
                                            randomData:randomData
                                        },
                                        success: function(data) {
                                            if (data.msg == "提交成功") {
                                                alert(data.msg+',数据库底部已增加该数据');


                                                // 将数据库最后一条数据显示到前台
                                                // $.ajax({
                                                //     type: "post",
                                                //     url: "lastData.php",
                                                //     dataType: "json",
                                                //     data:{
                                                //         randomData:randomData
                                                //     },
                                                //     success: function(data) {
                                                //         console.log(data);
                                                //         $(data[data.length - 1]).each(function(index) {
                                                //             // trData();
                                                //             var trs = $("<tr></tr>").appendTo("table").addClass("trs");
                                                //             $("<td></td>").appendTo(trs).text(this.newsid);
                                                //             $("<td></td>").appendTo(trs).text(this.newstitle);
                                                //             $("<td></td>").appendTo(trs).text(this.newsimg);
                                                //             $("<td></td>").appendTo(trs).text(this.newstext);
                                                //             $("<td></td>").appendTo(trs).text(this.newsdate);
                                                //             $("<td></td>").appendTo(trs).text(this.navdate);
                                                //             $("<a>").appendTo($("<td></td>").appendTo(trs).addClass("update")).text("修改");
                                                //             $("<a>").appendTo($("<td></td>").appendTo(trs)).text("删除");
                                                //         });
                                                //     },
                                                //     error:function(){
                                                //         alert("111发现您当前操作异常，为了安全起见，正在为你跳转登录页面...");
                                                //         window.location.href='index.html';
                                                //     }
                                                // });


                                                // 让提交收起
                                                $(".slide").slideUp(500);
                                                $(".slide").find("input").each(function(index) {
                                                    $(".slide").find("input").eq(index).val("");
                                                });

                                                window.location.reload();

                                            }

                                        },
                                        error:function(){
                                            alert("发现您当前操作异常，为了安全起见，正在为你跳转登录页面...");
                                            window.location.href='index.html';
                                        }
                                    });
                                });
                                // 将数据库数据显示到前台
                                $.ajax({
                                    type: "post",
                                    url: "mysql.php",
                                    dataType: "json",
                                    data:{
                                        randomData:randomData
                                    },
                                    success: function(data) {
                                        // console.log(data[data.length-1]);
                                        $(data).each(function(index) {
                                            // trData();
                                            var trs = $("<tr></tr>").appendTo("table").addClass("trs");
                                            $("<td></td>").appendTo(trs).text(this.newsid);
                                            $("<td></td>").appendTo(trs).text(this.newstitle);
                                            $("<td></td>").appendTo(trs).text(this.newsimg);
                                            $("<td></td>").appendTo(trs).text(this.newstext);
                                            $("<td></td>").appendTo(trs).text(this.newsdate);
                                            $("<td></td>").appendTo(trs).text(this.navdate);
                                            $("<a>").appendTo($("<td></td>").appendTo(trs).addClass("update")).text("修改");
                                            $("<a>").appendTo($("<td></td>").appendTo(trs).addClass("deletes")).text("删除");
                                            // console.log(data[index]);
                                        });

                                        // 修改的时候将table的值赋予input中
                                        $(".update").each(function(index) {
                                            // var update=$(this).find(".update");
                                            var thiss = $(this);
                                            thiss.click(function(e) {
                                                $(".slide1").slideDown(500);
                                                e.stopPropagation();
                                                var data1 = {};
                                                thiss.siblings().each(function(index) {
                                                    data1[index] = thiss.siblings().eq(index).text();
                                                    // console.log(data1[index]);
                                                });

                                                $(".slide1").find("input").each(function(index) {
                                                    $(".slide1").find("input").eq(index).val(data1[index]);
                                                });

                                            });
                                            // console.log($(data).length);

                                        });

                                        //删除数据
                                        $(".deletes").each(function(index) {
                                            $(this).click(function(index) {
                                                var num = $(this).siblings().eq(0).text();
                                                alert("确定删除newsid=" + num + "数据吗？");

                                                $(this).parent().remove();

                                                $.ajax({
                                                    url: "deleteData.php",
                                                    dataType: "json",
                                                    type: "post",
                                                    data: {
                                                        newsid: num,
                                                        randomData:randomData
                                                    },
                                                    success: function(data) {
                                                        alert(data.msg);

                                                    },
                                                    error:function(){
                                                        alert("发现您当前操作异常，为了安全起见，正在为你跳转登录页面...");
                                                        window.location.href='index.html';
                                                    }
                                                });
                                                // console.log($(this).siblings().eq(0).text());
                                            });

                                        });

                                    },
                                    error:function(){
                                        alert("您还没登录，正在为你跳转到登录页面...");
                                        window.location.href='index.html';
                                    }
                                });

                                // 点击修改提交
                                $("#submit2").click(function(e) {
                                    $.ajax({
                                        url: "add1.php",
                                        type: "post",
                                        dataType: "json",
                                        data: {
                                            newsid: $("#newsid1").val(),
                                            newstitle: $("#newstitle1").val(),
                                            newsimg: $("#newsimg1").val(),
                                            newstext: $("#newstext1").val(),
                                            newsdate: $("#newsdate1").val(),
                                            navdate: $("#navdate1").val(),
                                            randomData:randomData
                                        },
                                        success: function(data) {

                                            if (data.msg == "修改成功") {
                                                alert(data.msg);

                                                // 让提交收起
                                                $(".slide1").slideUp(500);
                                                $(".slide1").find("input").each(function(index) {
                                                    $(".slide1").find("input").eq(index).val("");
                                                });


                                                window.location.reload(); //刷新当前页面

                                            }

                                        },
                                        error:function(){
                                                        alert("发现您当前操作异常，为了安全起见，正在为你跳转登录页面...");
                                                        window.location.href='index.html';
                                        }
                                    });
                                });

                                // 查找数据
                                $("#submit3").click(function() {
                                    if ($("#newsid2").val() == "" && $("#newstitle2").val() == "" && $("#newsimg2").val() == "" && $("#newstext2").val() == "" && $("#newsdate2").val() == ""&& $("#navdate2").val() == "") {

                                        alert("至少要输入一项查找内容");
                                    } else {
                                        $.ajax({
                                            url: "lookUp.php",
                                            type: "post",
                                            dataType: "json",
                                            data: {
                                                newsid: $("#newsid2").val(),
                                                newstitle: $("#newstitle2").val(),
                                                newsimg: $("#newsimg2").val(),
                                                newstext: $("#newstext2").val(),
                                                newsdate: $("#newsdate2").val(),
                                                navdate: $("#navdate2").val(),
                                                randomData:randomData
                                            },
                                            success: function(data) {
                                                //console.log(data);
                                                //var objs={};
                                                $(data).each(function() {
                                                    var newsid = this.newsid,
                                                        newstitle = this.newstitle,
                                                        newsimg = this.newsimg,
                                                        newstext = this.newstext,
                                                        newsdate = this.newsdate,
                                                        navdate = this.navdate;

                                                    // 判断拿到的数据与表格的是否一致，把不一致的全部移除
                                                    $(".update").siblings().not(".deletes").each(function(index) {
                                                        var tdData = $(this).text(),
                                                            tdThis = $(this).parent().siblings(),
                                                            tdThis1 = $(this).parent().siblings().not(tdThis.first());

                                                        if (tdData == newsid) {
                                                            tdThis1.remove();
                                                        } else if (tdData == newstitle&&tdData == newsid) {
                                                            tdThis1.remove();
                                                        } else if (tdData == newsimg&&tdData == newsid) {
                                                            tdThis1.remove();
                                                        } else if (tdData == newstext&&tdData == newsid) {
                                                            tdThis1.remove();
                                                        } else if (tdData == newsdate&&tdData == newsid) {
                                                            tdThis1.remove();
                                                        } else if (tdData == navdate&&tdData == newsid) {
                                                            tdThis1.remove();
                                                        }
                                                    });

                                                    //console.log(newstitle);
                                                });

                                                // 查找成功之后自动收起来
                                                $(".slide2").slideUp(500);

                                                // 返回首页
                                                $("#add").text("返回首页");

                                                $("#add").click(function() {
                                                    window.location.reload();
                                                });


                                            },
                                            error:function(){
                                                        alert("发现您当前操作异常，为了安全起见，正在为你跳转登录页面...");
                                                        window.location.href='index.html';
                                            }
                                        });
                                    }

                                });









                                
                },
            });
// }

// $(".ssss").on("click",".random",function(){
//     alert($(".random").text());
// });
// console.log(randomData);
// console.log($(".ssss").children().text());







        // //删除数据
        // $("table").find("tr").each(function(index){
        //     $("table").on("click",".deletes",function(index){
        //         var num=$(this).siblings().eq(0).text();
        //         //alert("确定删除newsid="+num+"数据吗？");

        //         $(this).parent().remove();

        //         // console.log($(this).siblings().eq(0).text());
        //     });
        // });











     });
    </script>
</body>

</html>
